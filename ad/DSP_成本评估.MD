# DSP成本估计
***set_daemon@126.com 2018-04-15***

## 成本组成
一个平台运作需要考量人力、硬件、商务的成本。

### 人力
如果一个人能快速搞定产品、技术和商务的所有事情，那么可能只需要一个老板和一个这种牛人就能撑起一个公司（如果这个牛人是老板的话，一个儿就够了）。实际上，这种情况是有可能的，小作坊的起步方式，但能不能做起来还要靠后期，而且还是得增加人力来摊开整个事情。
就DSP平台而言，正规的人力构成是：产品、技术、、项目管理、运营、商务、媒介、销售。

#### 销售
销售对DSP平台起到极为重要的作用，没有销售订单，其他人的工作价值都得归零（正常情况下）。主要是要去拓展客户关系，争取有质量的合作，并维持客户关系。
对销售的招聘，主要看对接过的客户，手头具备的客户资源。

#### 商务
这里不是太熟，应该是对接内部法务以及对方公司商务，谈定商务条款。

#### 媒介
媒介人员主要工作是开拓媒体渠道，与各渠道沟通资源情况并建立良好关系，方便在必要时能拿到好的资源。

#### 产品人员
产品人员需要对广告产品有基本认知，了解DSP的运作机制及生态链，对竞品做基本研究。一般的工作有：策划设计业务系统、研究行业发展、制作产品推广计划和说明。

#### 运营
运营人员首先是要熟悉业务系统，了解运营的目标。一般的工作有：沟通客户需求、订单管理、投放优化、数据报告、反馈系统问题和提交新需求。注意：这里是代客户运营。

1. 当销售拉来客户订单后，运营需要和销售共同跟进客户需求，并将需求与产品、技术沟通，当前是否可以完成，是否要额外的开发和资源对接，可以做成什么样。
2. 确定需求后，对接客户的活动创意，根据现有的资源情况向客户提出意见和建议。
3. 上系统提交订单，制定投放策略
4. 观察投放情况，调整投放策略及创意
5. 定期与客户沟通投放情况，反馈投放数据
6. 为结案提供数据

6.1_1 发现产品在运营时的问题，记录问题，反馈给产品

#### 技术
技术可划分为：流量对接、投放引擎、业务后台开发、业务前端开发、数据平台运维、基础运维、数据分析及挖掘。

1. 流量对接
在投放端对接不同平台的流量形式，将其接入到投放引擎，并能监控投放数据。
2. 投放引擎
投放引擎要完成投放的基础框架，高并发接入竞价，高性能的筛选广告，控制预算，合理出价，合理广告排序。
3. 业务后台开发
开发业务系统，对接投放系统，对接媒体平台（提交素材审核）。
4. 业务前端开发
实现前端页面、H5制作。
5. 数据平台运维
负责hadoop/storm/kafka/spark等的运维。
6. 基础运维
负责线上服务器的管理，监控。
7. 数据分析及挖掘
实时计算、数据统计分析，点击预估等。

#### 项目推动
负责项目的计划，对接产品与研发，推动和跟踪项目。

### 硬件
硬件主要指服务器CPU、内存、存储、带宽、CDN。服务器的选配与业务及架构相关。

有一个估算方法，假设月业务量为`N`万，平均媒体cpm成本为`C`，那么每日的媒体量`Q=N/C/30`（单位cpm），这里可以作为竞价成功曝光的量。

设媒体采购的竞价成功率为w，那么需要推送广告竞价量为`p=Q/w`，从各媒体平台符合业务需求的流量占比为`o`，则每天需要的总流量`T=p/o`。

参与竞价的响应包体大小`r_0`字节，不参与竞价的响应包体大小`r_1`字节。

监控响应报文大小平均为`m_0`字节。

设点击率为`cr`，则产生的点击量为`c=cr*Q`。

假设竞价请求和推送的日志每条大小为`k_0`字节，竞价成功、曝光、点击日志每条日志大小为`k_1`。

假设素材:图片平均大小`s_0`字节，视频平均大小`s_1`字节，图片投放占比为`p_0`，则视频的占比为`1-p_0`。

可以得出以下数据：
1. 接入的流量QPS（单位：个/秒）
`t_s = T / 3600 / 24 = (p/o)/3600/24 = (Q/w/o)/3600/24 = (N/C/30/w/o)/3600/24`
2. 接入流量的带宽（单位：Mbps）
`n_w = ((t_s * o)*r_0 + (ts_*(1-o))*r_1) * 8 / 1024 / 1024`
3. 监控服务带宽（单位：Mbps）
`m_w = (N/C/30 / 3600/ 24 * (1+1+cr) * m_0) * 8 / 1024 / 1024`
4. 素材服务器带宽（单位：Mbps）
`i_w = (Q * p_0 * s_0 + Q * (1-p_0) * s_1) * 8 / 1024 / 1024`
5. CDN带宽总量（单位：GB/天）
`cdn_t = i_w / 8 / 1024 * 3600 * 24`

6. 存储服务器存储容量（GB/天）
竞价流量日志存储：`storage_c1 = t_s * 3600 * 24 * k_0 / 1024 / 1024 / 1024`
推送曝光点击日志存储：`storage_c2 = ((N/C/30 * (1+1+cr)) * k_1 + N/c/w/30*k_0) / 1024/1024/1024`
这里假设竞价流量日志的存储有效期为15天，推送、曝光、竞价成功和点击日志长期保存，但定期压缩。

7. 竞价服务器数量
假设每台竞价服务器的最大负载为qps_cap：
`bid_server_num = t_s / qps_cap`

8. kafka服务器

### 商务
商务上的成本主要是一些合作预付款，这部分费用需要预先支出。具体的费用与平台相关，比如有些平台需要预付5万，有的3万，而预付款又分可消费和不可消费，即预付10万，只能消费其中的5万，剩余5万做保证金。

## 总结
一个DSP平台，如果业务量大的时候，大部分成本会在硬件上，与业务量成正比，虽然成本高，但是也意味着业务体量大，标识着健康发展。
